<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paiement Mobile Money</title>
    <script src="https://js.stripe.com/v3/"></script> <!-- Charge Stripe.js -->
</head>
<body>
    <h1>Paiement via Mobile Money</h1>
    <form id="payment-form">
        <div id="payment-element">
            <label for="nom">Nom :</label>
            <input type="text" id="nom" name="nom"><br><br>
            <label for="email">Email :</label>
            <input type="email" id="email" name="email"><br><br>
            <label for="montant">Montant :</label>
            <input type="number" id="montant" name="montant"><br><br>
            <label for="operateur">Opérateur :</label>
            <select id="operateur" name="operateur">
              <option value="OrangeMoney">OrangeMoney</option>
              <option value="MobileMoney">MobileMoney</option>
            </select><br><br>
            <label for="numero">Numéro de téléphone :</label>
            <input type="tel" id="numero" name="numero"><br><br>
        </div>
        <button id="submit">Payer maintenant</button>
        <div id="error-message"></div>
    </form>

    <script>
        // Initialisation de Stripe avec la clé publique (remplacez par votre clé publique)
        const stripe = Stripe('pk_test_51Q40TIGL273siBXSgP66FtZUc6wjtx1yO9WE0PIKWJLdydpf2Wcpdyki4B5xzJYcE78AjIX2U1V9r8TKt7EXLg2z00pwAhqPj0'); 

        // Récupération du clientSecret depuis le backend
        fetch('/create-payment-intent.php') // Le fichier PHP backend doit renvoyer le clientSecret
            .then((response) => response.json())
            .then((data) => {
                const elements = stripe.elements();

                // Créez un élément de paiement Stripe pour MobileMoney
                const paymentElement = elements.create('payment', {
                    clientSecret: data.clientSecret, // Utilise le clientSecret reçu du backend
                    paymentMethodTypes: ['mobilemoney'], // Mobile Money comme méthode de paiement
                });

                // Montre le formulaire de paiement dans la div #payment-element
                paymentElement.mount('#payment-element'); 

                const form = document.getElementById('payment-form');
                const submitButton = document.getElementById('submit');

                // Gestion de la soumission du formulaire
                form.addEventListener('submit', async (event) => {
                    event.preventDefault();
                    submitButton.disabled = true; // Désactive le bouton pour éviter plusieurs soumissions

                    // Confirme le paiement à l'aide de Stripe.js
                    const { error } = await stripe.confirmPayment({
                        elements,
                        confirmParams: {
                            return_url: 'https://votredomaine.com/paiement-reussi', // Remplacez par l'URL où l'utilisateur sera redirigé après un paiement réussi
                        },
                    });

                    if (error) {
                        // Affiche un message d'erreur en cas de problème
                        document.getElementById('error-message').textContent = error.message;
                        submitButton.disabled = false; // Réactive le bouton en cas d'erreur
                    }
                });
            })
            .catch((error) => {
                console.error("Erreur lors de la création du Payment Intent:", error);
            });
    </script>
</body>
</html>
